{"version":3,"file":"Release-Z9WiU8_J.js","sources":["../../src/pages/Releases/Release.vue"],"sourcesContent":["<template>\r\n    <ItemDetail\r\n        :previewHeight=\"null\"\r\n        :aspectRatio=\"'1 / 1'\"\r\n        :invertShadow=\"sameColors === null ? null : !sameColors\"\r\n        v-if=\"data.ready\">\r\n        <template v-slot:background>\r\n            <Img\r\n                v-if=\"data.item?.cover\"\r\n                :preview=\"data.item?.cover?.crop\"\r\n                :original=\"data.item?.cover?.original\"\r\n                :alt=\"data.item.title\"\r\n                :skeleton=\"true\"\r\n                :checktone=\"true\"\r\n                @tone=\"data.tone = $event\"\r\n            />\r\n        </template>\r\n        <template v-slot:preview>\r\n            <div class=\"buttons\" v-if=\"data.tone\">\r\n                <IconButton :name=\"t('player.shuffle')\"\r\n                    :class=\"{ invert: !sameColors }\"\r\n                    class=\"tertiary size-xl dirty\" icon=\"random\"\r\n                />\r\n\r\n                <AudioToggle\r\n                    :state=\"state\"\r\n                    :light=\"true\"\r\n                    class=\"size-l secondary dirty\"\r\n                    :class=\"{ invert: data.tone !== 'dark' }\"\r\n                    @play=\"play\"\r\n                    @pause=\"pause\"\r\n                />\r\n            </div>\r\n        </template>\r\n        <template v-slot:toolbar>\r\n            <template v-if=\"data.tone\">\r\n                <IconButton\r\n                    icon=\"heart\"\r\n                    class=\"tertiary size-xl\"\r\n                    :class=\"{ invert: !sameColors }\"\r\n                    @click=\"like\"\r\n                />\r\n\r\n                <IconButton\r\n                    icon=\"tg-stars\"\r\n                    class=\"tertiary size-xl\"\r\n                    @click=\"like\"\r\n                />\r\n\r\n                <IconButton\r\n                    icon=\"apps\"\r\n                    class=\"tertiary size-l\"\r\n                    :class=\"{ invert: !sameColors }\"\r\n                    @click=\"openKebab\"\r\n                />\r\n            </template>\r\n        </template>\r\n        <template v-slot:detail>\r\n            <Tracks\r\n                v-if=\"data.item?.id\"\r\n                :getById=\"data.item.id\"\r\n                :loadMore=\"false\"\r\n                :source=\"{\r\n                    store: 'releases',\r\n                    fnName: 'getTracks'\r\n                }\"\r\n                :options=\"{\r\n                    type: 'release',\r\n                    id: data.item.id\r\n                }\"\r\n                :showKebab=\"true\"\r\n                :title=\"{ text: data.item.title }\"\r\n            />\r\n            \r\n\r\n            <template v-for=\"item in primaryArtists\" :key=\"item.id\">\r\n                <Releases\r\n                    type=\"row\"\r\n                    :take=\"8\"\r\n                    :skeletonCount=\"8\"\r\n                    :params=\"{\r\n                        contributors: item.id\r\n                    }\"\r\n                    :sort=\"null\"\r\n                    :title=\"{ text: t('blocks.releases.more-from-author', { name: item.name }) }\"\r\n                    handler=\"release\"\r\n                />\r\n            </template>\r\n\r\n            <template v-if=\"primaryArtists.length\">\r\n                <Artists\r\n                    :items=\"primaryArtists\"\r\n                    type=\"row\"\r\n                    :source=\"null\"\r\n                    :loadMore=\"false\"\r\n                    handler=\"artist\"\r\n                    title=\"blocks.artists.primary\"\r\n                />\r\n            </template>\r\n\r\n            <template v-if=\"featuresArtists.length\">\r\n                <Artists\r\n                    :items=\"featuresArtists\"\r\n                    type=\"row\"\r\n                    :source=\"null\"\r\n                    :loadMore=\"false\"\r\n                    handler=\"artist\"\r\n                    title=\"blocks.artists.features\"\r\n                />\r\n            </template>\r\n\r\n            <label id=\"errorLabel\" style=\"color:red;\"></label>\r\n\r\n    <!-- <audio controls preload=\"metadata\" src=\"https://api.wetap-tech-service.ru/track/stream-no-auth/cmhsxp63c2dw7oi13ac5pz9ar/ogg\" x-webkit-airplay=\"allow\" disableremoteplayback=\"true\" autoplay=\"0\"></audio> -->\r\n\r\n        </template>\r\n    </ItemDetail>\r\n\r\n    <Ready :page=\"`release-${props.id}`\" :init=\"init\" />\r\n</template>\r\n\r\n<script setup>\r\n    import { onMounted, onBeforeUnmount, reactive, computed } from 'vue';\r\n    import api from 'ðŸ”—/api';\r\n    import stores from '@/stores';\r\n    import Ready from 'ðŸ”—/components/ui/Ready.vue';\r\n    import Img from 'ðŸ”—/components/ui/Img.vue';\r\n    import Button from 'ðŸ”—/components/ui/Button.vue';\r\n    import ItemDetail from 'ðŸ”—/components/ui/ItemDetail.vue';\r\n    import ArtistPreviewCard from '@/components/ui/ArtistPreviewCard.vue';\r\n    import AudioToggle from 'ðŸ”—/components/ui/AudioToggle.vue';\r\n    import IconButton from 'ðŸ”—/components/ui/IconButton.vue';\r\n\r\n    import Releases from 'ðŸ”—/components/blocks/Releases.vue';\r\n    import Tracks from 'ðŸ”—/components/blocks/Tracks.vue';\r\n    import Artists from 'ðŸ”—/components/blocks/Artists.vue';\r\n    import { useI18n } from 'vue-i18n';\r\n    import moment from 'moment';\r\n    import { message } from 'ðŸ”—/utils/utils';\r\n\r\n    const { t } = useI18n();\r\n\r\n    const locale = stores.locale();\r\n    const tg = stores.tg();\r\n    const modals = stores.modals();\r\n    const others = stores.others();\r\n    const player = stores.player();\r\n\r\n    const props = defineProps({\r\n        id: { type: String }\r\n    });\r\n\r\n    const data = reactive({\r\n        ready: false,\r\n        item: null,\r\n        tone: null\r\n    });\r\n\r\n    const primaryArtists = computed(() => {\r\n        if (!data.item?.contributors?.length) {\r\n            return [];\r\n        }\r\n\r\n        return data.item.contributors.filter(item => item.role === 'PRIMARY' && item.state === 'CONFIRMED').map(item => item.artist);\r\n    });\r\n\r\n    const featuresArtists = computed(() => {\r\n        if (!data.item?.contributors?.length) {\r\n            return [];\r\n        }\r\n\r\n        return data.item.contributors.filter(item => item.role === 'FEATURED' && item.state === 'CONFIRMED').map(item => item.artist);\r\n    });\r\n\r\n    const state = computed(() => {\r\n        if (!data.item?.id || !player.panes.default || player.panes.default._queue?.id !== data.item?.id) {\r\n            return;\r\n        }\r\n\r\n        return player.panes.default._state;\r\n    });\r\n\r\n    const sameColors = computed(() => {\r\n        if (data.tone === null) {\r\n            return null;\r\n        }\r\n\r\n        return (others.theme !== 'dark' && data.tone !== 'dark') || (others.theme === 'dark' && data.tone === 'dark');\r\n    })\r\n\r\n    const pause = async () => {\r\n        player.release.pause(data.item.id);\r\n    }\r\n\r\n    const play = async () => {\r\n        player.release.play(data.item.id);\r\n    }\r\n\r\n    const like = (e) => {\r\n        let button = e?.target?.closest('button');\r\n\r\n        if (button) {\r\n            button.classList.remove('dunk');\r\n            setTimeout(() => {\r\n                button.classList.add('dunk');\r\n            }, 10);\r\n        }\r\n\r\n        message.info(t('common.soon'))\r\n    }\r\n\r\n    const openKebab = () => {\r\n        modals.open('release-kebab', { quietClose: true, data: {\r\n            id: props.id,\r\n            item: data.item\r\n        } })\r\n    }\r\n\r\n    const init = async () => {\r\n        data.item = await api.releases().get(props.id);\r\n        data.ready = true;\r\n    }\r\n\r\n    onMounted(async () => {\r\n        tg.showBackButton();\r\n        tg.showSettingsButton(openKebab);\r\n\r\n        window.onerror = function (message, source, lineno, colno, error) {\r\n    document.getElementById(\"errorLabel\").innerText =\r\n        \"ÐžÑˆÐ¸Ð±ÐºÐ°: \" + message +\r\n        \"\\nÐ¡Ñ‚Ñ€Ð¾ÐºÐ°: \" + lineno +\r\n        \"\\nÐ¤Ð°Ð¹Ð»: \" + source;\r\n};\r\n    });\r\n\r\n    onBeforeUnmount(() => {\r\n        tg.hideSettingsButton(openKebab);\r\n        tg.hideBackButton();\r\n    });\r\n</script>\r\n\r\n\r\n<style lang=\"scss\" scoped>\r\n    .title {\r\n        font: var(--font-h4);\r\n        color: white; //var(--white-500);\r\n        font-weight: bold;\r\n        text-align: center;\r\n        -webkit-text-stroke: 1px rgb(0, 0, 0, .2);\r\n    }\r\n\r\n    .buttons {\r\n        min-height: 38px;\r\n        display: flex;\r\n        flex-direction: row;\r\n        gap: 8px;\r\n        align-items: center;\r\n        justify-content: center;\r\n\r\n        button {\r\n            // min-width: 132px;\r\n        }\r\n    }\r\n</style>"],"names":[],"mappings":";;;;;;;;;;;;;;;AA2IA;AACA;;;;;;;AAnBc;AACd,IAkBI,MAAM,EAAE,CAAC,EAAE,GAAG,OAAO,EAAE,CAAC;AAC5B;AACA,IAAmB,MAAM,CAAC,MAAM,GAAG;AACnC,IAAI,MAAM,EAAE,GAAG,MAAM,CAAC,EAAE,EAAE,CAAC;AAC3B,IAAI,MAAM,MAAM,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC;AACnC,IAAI,MAAM,MAAM,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC;AACnC,IAAI,MAAM,MAAM,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC;AACnC;AACA,IAAI,MAAM,KAAK,GAAG,OAEZ,CAAC;AACP;AACA,IAAI,MAAM,IAAI,GAAG,QAAQ,CAAC;AAC1B,QAAQ,KAAK,EAAE,KAAK;AACpB,QAAQ,IAAI,EAAE,IAAI;AAClB,QAAQ,IAAI,EAAE,IAAI;AAClB,KAAK,CAAC,CAAC;AACP;AACA,IAAI,MAAM,cAAc,GAAG,QAAQ,CAAC,MAAM;AAC1C,QAAQ,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE;AAC9C,YAAY,OAAO,EAAE,CAAC;AACtB,QAAQ,CAAC;AACT;AACA,QAAQ,OAAO,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,KAAK,SAAS,IAAI,IAAI,CAAC,KAAK,KAAK,WAAW,CAAC,CAAC,GAAG,CAAC,IAAI,IAAI,IAAI,CAAC,MAAM,CAAC,CAAC;AACrI,IAAI,CAAC,CAAC,CAAC;AACP;AACA,IAAI,MAAM,eAAe,GAAG,QAAQ,CAAC,MAAM;AAC3C,QAAQ,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE;AAC9C,YAAY,OAAO,EAAE,CAAC;AACtB,QAAQ,CAAC;AACT;AACA,QAAQ,OAAO,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,KAAK,UAAU,IAAI,IAAI,CAAC,KAAK,KAAK,WAAW,CAAC,CAAC,GAAG,CAAC,IAAI,IAAI,IAAI,CAAC,MAAM,CAAC,CAAC;AACtI,IAAI,CAAC,CAAC,CAAC;AACP;AACA,IAAI,MAAM,KAAK,GAAG,QAAQ,CAAC,MAAM;AACjC,QAAQ,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,IAAI,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,KAAK,IAAI,CAAC,IAAI,EAAE,EAAE,EAAE;AAC1G,YAAY,OAAO;AACnB,QAAQ,CAAC;AACT;AACA,QAAQ,OAAO,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC;AAC3C,IAAI,CAAC,CAAC,CAAC;AACP;AACA,IAAI,MAAM,UAAU,GAAG,QAAQ,CAAC,MAAM;AACtC,QAAQ,IAAI,IAAI,CAAC,IAAI,KAAK,IAAI,EAAE;AAChC,YAAY,OAAO,IAAI,CAAC;AACxB,QAAQ,CAAC;AACT;AACA,QAAQ,OAAO,CAAC,MAAM,CAAC,KAAK,KAAK,MAAM,IAAI,IAAI,CAAC,IAAI,KAAK,MAAM,MAAM,MAAM,CAAC,KAAK,KAAK,MAAM,IAAI,IAAI,CAAC,IAAI,KAAK,MAAM,CAAC,CAAC;AACtH,IAAI,CAAC,EAAC;AACN;AACA,IAAI,MAAM,KAAK,GAAG,YAAY;AAC9B,QAAQ,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;AAC3C,IAAI,EAAC;AACL;AACA,IAAI,MAAM,IAAI,GAAG,YAAY;AAC7B,QAAQ,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;AAC1C,IAAI,EAAC;AACL;AACA,IAAI,MAAM,IAAI,GAAG,CAAC,CAAC,KAAK;AACxB,QAAQ,IAAI,MAAM,GAAG,CAAC,EAAE,MAAM,EAAE,OAAO,CAAC,QAAQ,CAAC,CAAC;AAClD;AACA,QAAQ,IAAI,MAAM,EAAE;AACpB,YAAY,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;AAC5C,YAAY,UAAU,CAAC,MAAM;AAC7B,gBAAgB,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;AAC7C,YAAY,CAAC,EAAE,EAAE,CAAC,CAAC;AACnB,QAAQ,CAAC;AACT;AACA,QAAQ,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,aAAa,CAAC,EAAC;AACtC,IAAI,EAAC;AACL;AACA,IAAI,MAAM,SAAS,GAAG,MAAM;AAC5B,QAAQ,MAAM,CAAC,IAAI,CAAC,eAAe,EAAE,EAAE,UAAU,EAAE,IAAI,EAAE,IAAI,EAAE;AAC/D,YAAY,EAAE,EAAE,KAAK,CAAC,EAAE;AACxB,YAAY,IAAI,EAAE,IAAI,CAAC,IAAI;AAC3B,SAAS,EAAE,EAAC;AACZ,IAAI,EAAC;AACL;AACA,IAAI,MAAM,IAAI,GAAG,YAAY;AAC7B,QAAQ,IAAI,CAAC,IAAI,GAAG,MAAM,GAAG,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;AACvD,QAAQ,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;AAC1B,IAAI,EAAC;AACL;AACA,IAAI,SAAS,CAAC,YAAY;AAC1B,QAAQ,EAAE,CAAC,cAAc,EAAE,CAAC;AAC5B,QAAQ,EAAE,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC;AACzC;AACA,QAAQ,MAAM,CAAC,OAAO,GAAG,UAAU,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE;AAC1E,IAAI,QAAQ,CAAC,cAAc,CAAC,YAAY,CAAC,CAAC,SAAS;AACnD,QAAQ,UAAU,GAAG,OAAO;AAC5B,QAAQ,YAAY,GAAG,MAAM;AAC7B,QAAQ,UAAU,GAAG,MAAM,CAAC;AAC5B,CAAC,CAAC;AACF,IAAI,CAAC,CAAC,CAAC;AACP;AACA,IAAI,eAAe,CAAC,MAAM;AAC1B,QAAQ,EAAE,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC;AACzC,QAAQ,EAAE,CAAC,cAAc,EAAE,CAAC;AAC5B,IAAI,CAAC,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}