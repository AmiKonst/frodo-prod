{"version":3,"file":"ModalGallery-DoQ6HQMn.js","sources":["../../shared/components/modals/ModalGallery.vue"],"sourcesContent":["<template>\r\n    <BaseModal\r\n        :name=\"props.name\"\r\n        :full=\"true\"\r\n        :mobileMode=\"true\"\r\n        :draggable=\"false\"\r\n        :closeOutside=\"true\"\r\n    >\r\n        <template #content>\r\n            <div class=\"gallery-wrapper\">\r\n\r\n                <div\r\n                    class=\"slides\"\r\n                    :style=\"{ transform: `translateX(${ -data.currentIndex * 100 }% )` }\"\r\n                    v-touch:swipe.left=\"data.scale === 1 ? next : null\"\r\n                    v-touch:swipe.right=\"data.scale === 1 ? prev : null\"\r\n                >\r\n\r\n                    <div\r\n                        class=\"slide\"\r\n                        v-for=\"(img, id) in data.imgs\"\r\n                        :key=\"id\"\r\n                    >\r\n                        <div\r\n                            class=\"zoom-container\"\r\n                            :class=\"{ loading: !data.loaded[id] }\"\r\n                            :style=\"{\r\n                                transform: `translate(${data.x}px, ${data.y}px) scale(${data.scale})`\r\n                            }\"\r\n\r\n                            v-touch:zoom=\"onZoom\"\r\n                            v-touch:zoom.in=\"onZoomStart\"\r\n                            v-touch:zoom.out=\"onZoomStart\"\r\n                            v-touch:drag=\"onDrag\"\r\n                        >\r\n                            <Loader class=\"opacity-mode\" v-if=\"!data.loaded[id]\" />\r\n\r\n                            <Transition name=\"fade\">\r\n                                <img :src=\"`${BASE_URL}${img.original || img.resized}`\"\r\n                                    v-show=\"data.loaded[id]\"\r\n                                    @load=\"onImageLoad(id)\"\r\n                                />\r\n                            </Transition>\r\n                        </div>\r\n                    </div>\r\n\r\n                </div>\r\n            </div>\r\n        </template>\r\n    </BaseModal>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, onMounted, watch, onBeforeUnmount } from 'vue';\r\nimport BaseModal from 'ðŸ”—/components/modals/BaseModal.vue';\r\nimport Loader from 'ðŸ”—/components/ui/Loader.vue';\r\nimport stores from '@/stores';\r\n\r\nconst modals = stores.modals();\r\n\r\nconst props = defineProps({\r\n    name: { type: String, default: 'gallery' }\r\n});\r\n\r\nconst BASE_URL = import.meta.env.VITE_APP_FILES_URL;\r\nconst MIN_SCALE = 1;\r\nconst MAX_SCALE = 4;\r\n\r\nconst data = reactive({\r\n    imgs: [],\r\n    currentIndex: 0,\r\n    loaded: {},\r\n    startScale: 1,\r\n    scale: 1,\r\n    x: 0,\r\n    y: 0\r\n});\r\n\r\nlet panStart = { x: 0, y: 0 };\r\nlet startX = 0;\r\nlet startY = 0;\r\n\r\nconst onZoom = (ev) => {\r\n    console.log(ev, 'zoom')\r\n    const newScale = Math.min(MAX_SCALE, Math.max(MIN_SCALE, data.startScale * ev));\r\n    // const newScale = Math.min(MAX_SCALE, Math.max(MIN_SCALE, data.startScale * ev.scale));\r\n\r\n    // ÐºÐ¾ÑÑ„Ñ„Ð¸Ñ†Ð¸ÐµÐ½Ñ‚ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð°\r\n    const scaleFactor = newScale / data.scale;\r\n\r\n    // Ð°ÐºÑ‚ÑƒÐ°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐµÐ¼ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸ÑŽ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ Ñ†ÐµÐ½Ñ‚Ñ€ Ð¾ÑÑ‚Ð°Ð²Ð°Ð»ÑÑ Ð½Ð° Ð¼ÐµÑÑ‚Ðµ\r\n    data.x = data.x * scaleFactor;\r\n    data.y = data.y * scaleFactor;\r\n\r\n    data.scale = newScale;\r\n};\r\n\r\nconst onZoomStart = () => {\r\n    console.log('start')\r\n    data.startScale = data.scale;\r\n};\r\n\r\n// Ð¤Ð¸ÐºÑÐ°Ñ†Ð¸Ñ Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ Ð¿Ñ€Ð¸ ÑÑ‚Ð°Ñ€Ñ‚Ðµ Ð¶ÐµÑÑ‚Ð°\r\nconst onDrag = (ev) => {\r\n    if (data.scale === 1) {\r\n        return;\r\n    }\r\n\r\n    data.x += ev.delta.x;\r\n    data.y += ev.delta.y;\r\n};\r\n\r\n\r\nconst close = () => {\r\n    modals.close(props.name);\r\n};\r\n\r\nconst next = () => {\r\n    if (data.currentIndex < data.imgs.length - 1) {\r\n        data.currentIndex += 1;\r\n        resetZoom();\r\n        data.loading = true;\r\n    }\r\n};\r\n\r\nconst prev = () => {\r\n    if (data.currentIndex > 0) {\r\n        data.currentIndex -= 1;\r\n        resetZoom();\r\n    }\r\n};\r\n\r\nconst onImageLoad = (id) => {\r\n    data.loaded[id] = true;\r\n};\r\n\r\nconst resetZoom = () => {\r\n    data.scale = 1;\r\n    data.startScale = 1;\r\n    data.x = 0;\r\n    data.y = 0;\r\n};\r\n\r\nonMounted(() => {\r\n    const payload = modals.getData(props.name);\r\n\r\n    if (payload?.imgs?.length) {\r\n        data.imgs = payload.imgs;\r\n    }\r\n});\r\n\r\nonBeforeUnmount(() => {\r\n});\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.gallery-wrapper {\r\n    position: relative;\r\n    width: 100%;\r\n    height: 100%;\r\n    overflow: hidden;\r\n    min-height: 100vh;\r\n\r\n    .slides {\r\n        display: flex;\r\n        width: 100%;\r\n        height: 100%;\r\n        transition: transform 0.25s ease;\r\n        min-height: 100vh;\r\n        .slide {\r\n            flex: 0 0 100%;\r\n            display: flex;\r\n            justify-content: center;\r\n            align-items: center;\r\n            overflow: hidden;\r\n            .zoom-container {\r\n                touch-action: none;\r\n                will-change: transform;\r\n                transition: transform 0.1s ease;\r\n                &.loading {\r\n                    min-width: 100%;\r\n                    min-height: 100%;\r\n                }\r\n\r\n                img {\r\n                    max-width: 100%;\r\n                    max-height: 100%;\r\n                    user-select: none;\r\n                    // pointer-events: none;\r\n                }\r\n\r\n                .opacity-mode {\r\n                    user-select: none;\r\n                    pointer-events: none;\r\n                    position: absolute;\r\n                    top: 0;\r\n                    left: 0;\r\n                    right: 0;\r\n                    bottom: 25%;\r\n                    height: auto;\r\n                }\r\n\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n.fade-enter-from, .fade-leave-to {\r\n    opacity: 0;\r\n}\r\n.fade-enter-to, .fade-leave-from {\r\n    opacity: 1;\r\n}\r\n.fade-enter-active, .fade-leave-active {\r\n    transition: opacity 0.4s ease;\r\n}\r\n</style>\r\n"],"names":[],"mappings":"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"}