{"version":3,"file":"ModalGallery-BXQntXsO.js","sources":["../../shared/components/modals/ModalGallery.vue"],"sourcesContent":["<template>\r\n    <BaseModal\r\n        :name=\"props.name\"\r\n        :full=\"true\"\r\n        :mobileMode=\"true\"\r\n        :draggable=\"false\"\r\n        :closeOutside=\"true\"\r\n    >\r\n        <template #content>\r\n            <div class=\"gallery-wrapper\">\r\n\r\n                <div\r\n                    class=\"slides\"\r\n                    :style=\"{ transform: `translateX(${ -data.currentIndex * 100 }% )` }\"\r\n                    v-touch:swipe.left=\"next\"\r\n                    v-touch:swipe.right=\"prev\"\r\n                >\r\n\r\n                    <div\r\n                        class=\"slide\"\r\n                        v-for=\"(img, id) in data.imgs\"\r\n                        :key=\"id\"\r\n                    >\r\n                        <div\r\n                            class=\"zoom-container\"\r\n                            :class=\"{ loading: !data.loaded[id] }\"\r\n                            :style=\"{\r\n                                transform: `translate(${data.x}px, ${data.y}px) scale(${data.scale}) rotate(${data.rotate}deg)`,\r\n                                opacity: data.opacity,\r\n                            }\"\r\n\r\n                            v-touch:zoom=\"onZoom\"\r\n                            @touchstart=\"onTouchStart\"\r\n                            @touchmove.prevent=\"onTouchMove\"\r\n                            @touchend=\"onTouchEnd\"\r\n                        >\r\n                                <!-- transition: 'none' -->\r\n                                <!-- !data.isClosing ? 'none' : 'transform 0.3s ease, opacity 0.3s ease' -->\r\n                            <Loader class=\"opacity-mode\" v-if=\"!data.loaded[id]\" />\r\n\r\n                            <Transition name=\"fade\">\r\n                                <img :src=\"`${BASE_URL}${img.original || img.resized}`\"\r\n                                    v-show=\"data.loaded[id]\"\r\n                                    @load=\"onImageLoad(id)\"\r\n                                />\r\n                            </Transition>\r\n                        </div>\r\n                    </div>\r\n\r\n                </div>\r\n            </div>\r\n        </template>\r\n    </BaseModal>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, onMounted, watch, onBeforeUnmount } from 'vue';\r\nimport BaseModal from 'ðŸ”—/components/modals/BaseModal.vue';\r\nimport Loader from 'ðŸ”—/components/ui/Loader.vue';\r\nimport stores from '@/stores';\r\n\r\nconst modals = stores.modals();\r\n\r\nconst props = defineProps({\r\n    name: { type: String, default: 'gallery' }\r\n});\r\n\r\nconst BASE_URL = import.meta.env.VITE_APP_FILES_URL;\r\nconst MIN_SCALE = 1;\r\nconst MAX_SCALE = 4;\r\nconst CLOSE_THRESHOLD = 150;\r\n\r\nconst data = reactive({\r\n    imgs: [],\r\n    currentIndex: 0,\r\n    loaded: {},\r\n    scale: 1,\r\n    x: 0,\r\n    y: 0,\r\n    opacity: 1,\r\n    rotate: 0,\r\n    isClosing: false\r\n});\r\n\r\nlet start = null;\r\nlet lastTap = 0;\r\n\r\nconst onZoom = (factor) => {\r\n    const newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, data.scale * factor));\r\n\r\n    const scaleFactor = newScale / data.scale;\r\n\r\n    data.x = data.scale === 1 ? 0 : parseInt(data.x * scaleFactor);\r\n    data.y = data.scale === 1 ? 0 : parseInt(data.y * scaleFactor);\r\n\r\n    data.scale = newScale;\r\n};\r\n\r\n\r\nconst onTouchStart = (e) => {\r\n    if (e.touches.length !== 1) {\r\n        return;\r\n    }\r\n\r\n    const now = Date.now();\r\n\r\n    if (now - lastTap < 300) {\r\n        if (data.scale === 1) {\r\n            data.scale = MAX_SCALE;\r\n        } else {\r\n            resetZoom();\r\n        }\r\n\r\n        lastTap = 0; // ÑÐ±Ñ€Ð¾Ñ\r\n        e.preventDefault(); // Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ðµ ÑÑ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ð» drag\r\n        return;\r\n    }\r\n\r\n    lastTap = now;\r\n\r\n    start = { x: e.touches[0].clientX, y: e.touches[0].clientY };\r\n    data.isClosing = false;\r\n};\r\n\r\nconst onTouchMove = (e) => {\r\n    if (!start || e.touches.length !== 1) {\r\n        return;\r\n    }\r\n\r\n    const dx = e.touches[0].clientX - start.x;\r\n    const dy = e.touches[0].clientY - start.y;\r\n\r\n    if (data.scale > 1) {\r\n        data.x += dx;\r\n        data.y += dy;\r\n        data.isClosing = false;\r\n    } else if (dy) {\r\n        data.isClosing = true;\r\n        data.y = Math.max(0, data.y + dy);\r\n        const factor = Math.min(data.y / (window.innerHeight / 2), 1);\r\n        data.opacity = 1 - factor * 0.8;\r\n        data.rotate = factor * 10;\r\n    }\r\n\r\n    start = { x: e.touches[0].clientX, y: e.touches[0].clientY };\r\n};\r\n\r\nconst onTouchEnd = () => {\r\n    if (data.isClosing) {\r\n        if (data.y > CLOSE_THRESHOLD) {\r\n            close();\r\n        } else {\r\n            data.y = 0;\r\n            data.opacity = 1;\r\n            data.rotate = 0;\r\n        }\r\n    }\r\n\r\n    start = null;\r\n    data.isClosing = false;\r\n};\r\n\r\nconst close = () => {\r\n    modals.close(props.name);\r\n};\r\n\r\nconst next = () => {\r\n    if (data.scale !== 1) {\r\n        return;\r\n    }\r\n\r\n    if (data.currentIndex < data.imgs.length - 1) {\r\n        data.currentIndex += 1;\r\n        resetZoom();\r\n        data.loading = true;\r\n    }\r\n};\r\n\r\nconst prev = () => {\r\n    if (data.scale !== 1) {\r\n        return;\r\n    }\r\n\r\n    if (data.currentIndex > 0) {\r\n        data.currentIndex -= 1;\r\n        resetZoom();\r\n    }\r\n};\r\n\r\nconst onImageLoad = (id) => {\r\n    data.loaded[id] = true;\r\n};\r\n\r\nconst resetZoom = () => {\r\n    data.scale = 1;\r\n    data.x = 0;\r\n    data.y = 0;\r\n    data.opacity = 1;\r\n    data.rotate = 0;\r\n};\r\n\r\nonMounted(() => {\r\n    const payload = modals.getData(props.name);\r\n\r\n    if (payload?.imgs?.length) {\r\n        data.imgs = payload.imgs;\r\n    }\r\n});\r\n\r\nonBeforeUnmount(() => {\r\n});\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.gallery-wrapper {\r\n    position: relative;\r\n    width: 100%;\r\n    height: 100%;\r\n    overflow: hidden;\r\n    min-height: 100vh;\r\n\r\n    .slides {\r\n        display: flex;\r\n        width: 100%;\r\n        height: 100%;\r\n        transition: transform 0.25s ease;\r\n        min-height: 100vh;\r\n        .slide {\r\n            flex: 0 0 100%;\r\n            display: flex;\r\n            justify-content: center;\r\n            align-items: center;\r\n            overflow: hidden;\r\n            .zoom-container {\r\n                touch-action: none;\r\n                // will-change: transform;\r\n                // transition: transform 0.1s ease;\r\n                &.loading {\r\n                    min-width: 100%;\r\n                    min-height: 100%;\r\n                }\r\n\r\n                img {\r\n                    max-width: 100%;\r\n                    max-height: 100%;\r\n                    user-select: none;\r\n                    // pointer-events: none;\r\n                }\r\n\r\n                .opacity-mode {\r\n                    user-select: none;\r\n                    pointer-events: none;\r\n                    position: absolute;\r\n                    top: 0;\r\n                    left: 0;\r\n                    right: 0;\r\n                    bottom: 25%;\r\n                    height: auto;\r\n                }\r\n\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n.fade-enter-from, .fade-leave-to {\r\n    opacity: 0;\r\n}\r\n.fade-enter-to, .fade-leave-from {\r\n    opacity: 1;\r\n}\r\n.fade-enter-active, .fade-leave-active {\r\n    transition: opacity 0.4s ease;\r\n}\r\n</style>\r\n"],"names":[],"mappings":"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"}