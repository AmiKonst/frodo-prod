{"version":3,"file":"ModalTrackDownload-DrYlvYtu.js","sources":["../../src/components/modals/ModalTrackDownload.vue"],"sourcesContent":["<template>\r\n    <BaseModal\r\n        name=\"track-download\"\r\n        :mobileMode=\"true\"\r\n        :closeOutside=\"true\"\r\n        :secondary=\"true\"\r\n        :isLoading=\"data.loading\"\r\n    >\r\n        <template v-slot:title>\r\n            <div class=\"title\">\r\n                <div class=\"img\" @click=\"gallery\">\r\n                    <Img v-if=\"data.item?.cover?.resized\"\r\n                        :preview=\"data.item?.cover?.resized\"\r\n                        :original=\"data.item?.cover?.original\"\r\n                        :alt=\"data.item?.title\"\r\n                        aspectRatio=\"1 / 1\"\r\n                    />\r\n                </div>\r\n                <span>{{ data.item?.title }}</span>\r\n            </div>\r\n        </template>\r\n        <template v-slot:content>\r\n            <ul class=\"kebab-list\" v-if=\"data.item?.id\">\r\n                <li class=\"static\" v-if=\"data.item.contentId\">\r\n                    <label>\r\n                        {{ t('modals.track-download.content-id.title') }}\r\n                    </label>\r\n                    <div>\r\n                        <p>\r\n                            {{ t('modals.track-download.content-id.description') }}\r\n                        </p>\r\n                        <span class=\"icons\">\r\n                            <Icon icon=\"youtube\"/>\r\n                        </span>\r\n                    </div>\r\n                </li>\r\n\r\n                <li class=\"static\" v-if=\"data.item.hasProRights\">\r\n                    <label>\r\n                        {{ t('modals.track-download.pro.title') }}\r\n                    </label>\r\n                    <div>\r\n                        <p>\r\n                            {{ t('modals.track-download.pro.description') }}\r\n                        </p>\r\n                        <span class=\"icons\">\r\n                            <Icon icon=\"tv\"/>\r\n                            <Icon icon=\"radio\"/>\r\n                            <Icon icon=\"shop\"/>\r\n                        </span>\r\n                    </div>\r\n                </li>\r\n\r\n                <li class=\"download free\" v-if=\"data.item.nonCommercialUsage\">\r\n                    <div>\r\n                        <label>\r\n                            {{ t('modals.track-download.free.title') }}\r\n                        </label>\r\n                    </div>\r\n                    <div>\r\n                        <p v-html=\"t('modals.track-download.free.description', { artist: artists.join(', ') })\"></p>\r\n\r\n                        <Button :name=\"t('modals.track-download.free.download')\"\r\n                            class=\"size-s\"\r\n                            :class=\"{ secondary: !data.downloading }\"\r\n                            :loading=\"data.downloading\"\r\n                            @click=\"download\"\r\n                        />\r\n                    </div>\r\n                </li>\r\n\r\n                <template v-if=\"data.licenses?.length\">\r\n                    <li v-for=\"item in data.licenses\" :id=\"item.id\" class=\"download\">\r\n                        <div>\r\n                            <label>\r\n                                {{ item.provider?.name }}\r\n                            </label>\r\n\r\n                            <Img v-if=\"item.provider?.profileImage?.resized\"\r\n                                :preview=\"item.provider?.profileImage?.resized\"\r\n                                :original=\"item.provider?.profileImage?.original\"\r\n                                :alt=\"item.provider?.name\"\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <p>\r\n                                {{ item.provider?.description }}\r\n                            </p>\r\n\r\n                            <Button :name=\"t('modals.track-download.external.open')\"\r\n                                class=\"secondary size-s\"\r\n                                @click=\"openExternal(item)\"\r\n                            />\r\n                        </div>\r\n                    </li>\r\n                </template>\r\n            </ul>\r\n        </template>\r\n    </BaseModal>\r\n</template>\r\n\r\n<script setup>\r\nimport { onMounted, reactive, computed } from 'vue';\r\nimport { useI18n } from 'vue-i18n';\r\n\r\nimport Img from 'ðŸ”—/components/ui/Img.vue';\r\nimport Button from 'ðŸ”—/components/ui/Button.vue';\r\nimport BaseModal from 'ðŸ”—/components/modals/BaseModal.vue';\r\nimport stores from '@/stores';\r\n\r\nimport api from 'ðŸ”—/api';\r\nimport { message } from 'ðŸ”—/utils/utils';\r\n\r\nconst { t } = useI18n();\r\n\r\nconst tg = stores.tg();\r\nconst modals = stores.modals();\r\n\r\nconst data = reactive({\r\n    loading: true,\r\n    downloading: false,\r\n});\r\n\r\nconst gallery = () => {\r\n    if (!data.item?.id || !data.item?.cover?.original) {\r\n        return;\r\n    }\r\n\r\n    modals.open('gallery', { data: { imgs: [{\r\n        title: data.item.title,\r\n        ...data.item?.cover\r\n    }] } });\r\n}\r\n\r\nconst download = async () => {\r\n    data.downloading = true;\r\n\r\n    const arrayBuffer = await api.tracks().downloadWholeFile(data.item?.id, 'ogg');\r\n\r\n    const blob = new Blob([arrayBuffer], { type: 'audio/mpeg' });\r\n\r\n    const name = `${artists.value.join(', ')} - ${data.item.title} (BilboMusic).ogg`;\r\n\r\n    const file = new File([blob], name);\r\n\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement(\"a\");\r\n    a.href = url;\r\n    a.download = name;\r\n    a.click();\r\n\r\n    URL.revokeObjectURL(url);\r\n    data.downloading = false;\r\n}\r\n\r\nconst artists = computed(() => {\r\n    if (!data.item?.contributors?.length) {\r\n        return;\r\n    }\r\n\r\n    return data.item.contributors.filter(item => item.role === 'PRIMARY' && item.state === 'CONFIRMED').map(item => item.artist.name)\r\n});\r\n\r\nconst openExternal = (item) => {\r\n\r\n    if (!item?.url) {\r\n        return\r\n    }\r\n\r\n    tg.openLink({\r\n        external_url: `${item.url}?${item.provider.getParams}`\r\n    });\r\n};\r\n\r\nconst close = () => {\r\n    modals.close('track-download');\r\n};\r\n\r\nonMounted(async () => {\r\n    const payload = modals.getData('track-download');\r\n\r\n    if (!payload?.id) {\r\n        close();\r\n        return;\r\n    }\r\n\r\n    if (payload.item) {\r\n        data.item = payload.item;\r\n    } else {\r\n        data.item = await api.tracks().get(payload.id);\r\n    }\r\n\r\n    data.licenses = await api.licenses().tracks.list(payload.id);\r\n\r\n    data.loading = false;\r\n});\r\n\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n    .title {\r\n        display: flex;\r\n        width: 100%;\r\n        align-items: center;\r\n        gap: 24px;\r\n        flex-direction: column;\r\n        padding-top: 12px;\r\n\r\n        .img {\r\n            width: 74px;\r\n            height: 74px;\r\n            border-radius: 12px;\r\n            @include animage-booble-shadow;\r\n\r\n            img {\r\n                width: 100%;\r\n                height: 100%;\r\n                border-radius: 12px;\r\n            }\r\n        }\r\n    }\r\n\r\n    .buttons {\r\n        display: flex;\r\n        flex-direction: row;\r\n        gap: 8px;\r\n        align-items: center;\r\n        justify-content: center;\r\n    }\r\n\r\n    ul.kebab-list {\r\n        @include settings-list;\r\n        margin-top: 24px;\r\n\r\n        gap: 32px;\r\n        display: flex;\r\n        flex-direction: column;\r\n        li {\r\n            &.static {\r\n                display: flex;\r\n                flex-direction: column;\r\n                gap: 8px;\r\n                align-items: start;\r\n                justify-content: space-between;\r\n\r\n                label {\r\n                    font: var(--font-body-1);\r\n                    color: var(--dark-500);\r\n                }\r\n\r\n                & > div {\r\n                    display: flex;\r\n                    flex-direction: row;\r\n                    gap: 16px;\r\n                    align-items: start;\r\n                    justify-content: space-between;\r\n                    width: 100%;\r\n                }\r\n\r\n                .icons {\r\n                    display: flex;\r\n                    flex-direction: row;\r\n                    gap: 8px;\r\n                    svg {\r\n                        margin-top: -8px;\r\n                        height: 38px;\r\n                        fill: var(--dark-20);\r\n                        width: 38px;\r\n                    }\r\n                }\r\n\r\n                p {\r\n                    margin: 0;\r\n                    padding: 0 0;\r\n                    font: var(--font-body-2);\r\n                    color: var(--dark-80);\r\n                }\r\n            }\r\n\r\n            &.download {\r\n                display: flex;\r\n                flex-direction: column;\r\n                gap: 8px;\r\n                align-items: start;\r\n\r\n                & > div {\r\n                    display: flex;\r\n                    flex-direction: row;\r\n                    align-items: center;\r\n                    justify-content: start;\r\n                    gap: 16px;\r\n\r\n                    img {\r\n                        height: 38px;\r\n                        border-radius: 12px;\r\n                    }\r\n\r\n                    label {\r\n                        font: var(--font-h6);\r\n                        color: var(--dark-500);\r\n                    }\r\n\r\n                    p {\r\n                        margin: 0;\r\n                        padding: 0;\r\n                        font: var(--font-body-2);\r\n                        color: var(--dark-500);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n</style>\r\n"],"names":[],"mappings":"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"}