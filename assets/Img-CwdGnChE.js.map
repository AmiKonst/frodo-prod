{"version":3,"file":"Img-CwdGnChE.js","sources":["../../shared/components/ui/Img.vue"],"sourcesContent":["<template>\r\n    <!-- watermark -->\r\n    <div v-if=\"props.wathermark\" class=\"wathermark\" :class=\"props.wathermark\">\r\n        <img\r\n            v-if=\"props.preview\"\r\n            :src=\"src\"\r\n            :alt=\"props.alt\"\r\n            crossorigin=\"anonymous\"\r\n            @load=\"handleLoad\"\r\n            @error=\"handleError\"\r\n        />\r\n        <span></span>\r\n        <label>\r\n            <slot>{{ props.alt }}</slot>\r\n        </label>\r\n    </div>\r\n\r\n    <!-- skeleton -->\r\n    <div v-else-if=\"props.skeleton\" class=\"skeleton-wrapper\" :class=\"{ loaded: isLoaded }\">\r\n        <img\r\n            v-if=\"props.preview\"\r\n            :src=\"src\"\r\n            :alt=\"props.alt\"\r\n            crossorigin=\"anonymous\"\r\n            @load=\"handleLoad\"\r\n            @error=\"handleError\"\r\n        />\r\n    </div>\r\n\r\n    <!-- обычное изображение -->\r\n    <img\r\n        v-else\r\n        :src=\"src\"\r\n        :alt=\"props.alt\"\r\n        crossorigin=\"anonymous\"\r\n        @load=\"handleLoad\"\r\n        @error=\"handleError\"\r\n    />\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed } from 'vue';\r\n\r\nconst props = defineProps({\r\n    preview: { type: String, default: '' },\r\n    original: { type: String, default: '' },\r\n    alt: { type: String, default: '' },\r\n    wathermark: { type: [String, null], default: null },\r\n    skeleton: { type: Boolean, default: false },\r\n    checktone: { type: Boolean, default: false }\r\n});\r\n\r\nconst emit = defineEmits(['load', 'error', 'tone']);\r\n\r\nconst isLoaded = ref(false);\r\n\r\nconst checkTone = (e) => {\r\n\r\n    const image = e.target;\r\n    const canvas = document.createElement('canvas');\r\n    const ctx = canvas.getContext('2d');\r\n\r\n    // Размеры canvas ограничим до 100px по ширине, пропорционально\r\n    const sampleWidth = 100;\r\n    const aspectRatio = image.naturalHeight / image.naturalWidth;\r\n    canvas.width = sampleWidth;\r\n    canvas.height = sampleWidth * aspectRatio;\r\n\r\n    // Рисуем картинку\r\n    ctx?.drawImage(image, 0, 0, canvas.width, canvas.height);\r\n\r\n    try {\r\n        const imageData = ctx?.getImageData(0, canvas.height * 0.66, canvas.width, canvas.height * 0.33);\r\n        if (!imageData) return;\r\n\r\n        let totalLuminance = 0;\r\n        const data = imageData.data;\r\n        const pixelCount = data.length / 4;\r\n\r\n        for (let i = 0; i < data.length; i += 4) {\r\n            const r = data[i];\r\n            const g = data[i + 1];\r\n            const b = data[i + 2];\r\n\r\n            // Расчёт относительной яркости по формуле W3C\r\n            const luminance = 0.2126 * r + 0.7152 * g + 0.0722 * b;\r\n            totalLuminance += luminance;\r\n        }\r\n\r\n        const avgLuminance = totalLuminance / pixelCount;\r\n\r\n        // Пороговое значение яркости (можно адаптировать)\r\n        const tone = avgLuminance < 128 ? 'dark' : 'light';\r\n\r\n        emit('tone', tone);\r\n    } catch (err) {\r\n    }\r\n}\r\n\r\nfunction handleLoad(e) {\r\n    isLoaded.value = true;\r\n\r\n    if (props.checktone) {\r\n        checkTone(e);   \r\n    }\r\n\r\n    emit('load', e);\r\n}\r\n\r\nfunction handleError(e) {\r\n    // isLoaded.value = true;\r\n    emit('error', e);\r\n}\r\n\r\nconst src = computed(() => {\r\n    return `${props.preview?.indexOf('http') === -1 ? import.meta.env.VITE_APP_FILES_URL : ''}${props.preview}`;\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\nimg {\r\n}\r\n\r\n.skeleton-wrapper {\r\n    position: relative;\r\n    width: 100%;\r\n    height: 100%;\r\n\r\n    img {\r\n        position: relative;\r\n        width: 100%;\r\n        height: 100%;\r\n        opacity: 0;\r\n        transition: opacity .2s;\r\n        object-fit: cover;\r\n        overflow: hidden;\r\n    }\r\n\r\n    &::after {\r\n        content: '';\r\n        @include skeleton;\r\n        display: block;\r\n        z-index: 1;\r\n    }\r\n\r\n    &.loaded {\r\n        img {\r\n            opacity: 1;\r\n        }\r\n    }\r\n\r\n    &.loaded::after {\r\n        display: none;\r\n    }\r\n}\r\n\r\n.wathermark {\r\n    position: relative;\r\n    overflow: hidden;\r\n\r\n    img {\r\n        width: 100%;\r\n        height: 100%;\r\n        object-fit: cover;\r\n    }\r\n\r\n    span {\r\n        position: absolute;\r\n        width: 100%;\r\n        height: 100%;\r\n        right: 0;\r\n        bottom: 0;\r\n        mask-repeat: no-repeat;\r\n        mask-size: cover;\r\n        mask-position: 0px 30px;\r\n        -webkit-mask-repeat: no-repeat;\r\n        -webkit-mask-size: cover;\r\n        -webkit-mask-position: 0px 30px;\r\n        backdrop-filter: blur(4px);\r\n        background: var(--dark-20);\r\n        transition: all 0.4s;\r\n        pointer-events: none;\r\n    }\r\n\r\n    &.genres span {\r\n        mask-image: url('data:image/svg+xml;utf8,<svg viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\\'M0,100 L0,60 C30,70 60,20 100,10 L100,100 Z\\' fill=\"white\"/></svg>');\r\n\r\n        -webkit-mask-image: url('data:image/svg+xml;utf8,<svg viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\\'M0,100 L0,60 C30,70 60,20 100,10 L100,100 Z\\' fill=\"white\"/></svg>');\r\n    }\r\n\r\n    &.categories span {\r\n        mask-image: url('data:image/svg+xml;utf8,<svg viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M0,100 L0,55 C25,65 55,25 100,15 L100,100 Z\" fill=\"white\"/></svg>');\r\n\r\n        -webkit-mask-image: url('data:image/svg+xml;utf8,<svg viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M0,100 L0,55 C25,65 55,25 100,15 L100,100 Z\" fill=\"white\"/></svg>');\r\n    }\r\n\r\n    &.moods span {\r\n        mask-image: url('data:image/svg+xml;utf8,<svg viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M0,100 L0,50 C20,80 80,20 100,40 L100,100 Z\" fill=\"white\"/></svg>');\r\n        -webkit-mask-image: url('data:image/svg+xml;utf8,<svg viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M0,100 L0,50 C20,80 80,20 100,40 L100,100 Z\" fill=\"white\"/></svg>');\r\n    }\r\n\r\n    &.playlists span {\r\n        mask-image: url('data:image/svg+xml;utf8,<svg viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M100,100 L100,55 C75,65 45,25 0,15 L0,100 Z\" fill=\"white\"/></svg>');\r\n\r\n        -webkit-mask-image: url('data:image/svg+xml;utf8,<svg viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M100,100 L100,55 C75,65 45,25 0,15 L0,100 Z\" fill=\"white\"/></svg>');\r\n    }\r\n\r\n    label {\r\n        position: absolute;\r\n        right: 8px;\r\n        bottom: 8px;\r\n        font: var(--font-body-1);\r\n        color: var(--white-500);\r\n        text-align: right;\r\n        pointer-events: none;\r\n        text-shadow: 0px 0px 3px var(--dark-500);\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 8px;\r\n        justify-content: end;\r\n        align-items: end;\r\n    }\r\n\r\n    &:hover {\r\n        span {\r\n            backdrop-filter: blur(8px);\r\n        }\r\n    }\r\n}\r\n</style>\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AA2CA,IAAA,MAAM,KAAA,GAAQ,OAAA;AASd,IAAA,MAAM,IAAA,GAAO,MAAA;AAEb,IAAA,MAAM,QAAA,GAAW,IAAI,KAAK,CAAA;AAE1B,IAAA,MAAM,SAAA,GAAY,CAAC,CAAA,KAAM;AAErB,MAAA,MAAM,QAAQ,CAAA,CAAE,MAAA;AAChB,MAAA,MAAM,MAAA,GAAS,QAAA,CAAS,aAAA,CAAc,QAAQ,CAAA;AAC9C,MAAA,MAAM,GAAA,GAAM,MAAA,CAAO,UAAA,CAAW,IAAI,CAAA;AAGlC,MAAA,MAAM,WAAA,GAAc,GAAA;AACpB,MAAA,MAAM,WAAA,GAAc,KAAA,CAAM,aAAA,GAAgB,KAAA,CAAM,YAAA;AAChD,MAAA,MAAA,CAAO,KAAA,GAAQ,WAAA;AACf,MAAA,MAAA,CAAO,SAAS,WAAA,GAAc,WAAA;AAG9B,MAAA,GAAA,EAAK,UAAU,KAAA,EAAO,CAAA,EAAG,GAAG,MAAA,CAAO,KAAA,EAAO,OAAO,MAAM,CAAA;AAEvD,MAAA,IAAI;AACA,QAAA,MAAM,SAAA,GAAY,GAAA,EAAK,YAAA,CAAa,CAAA,EAAG,MAAA,CAAO,MAAA,GAAS,IAAA,EAAM,MAAA,CAAO,KAAA,EAAO,MAAA,CAAO,MAAA,GAAS,IAAI,CAAA;AAC/F,QAAA,IAAI,CAAC,SAAA,EAAW;AAEhB,QAAA,IAAI,cAAA,GAAiB,CAAA;AACrB,QAAA,MAAM,OAAO,SAAA,CAAU,IAAA;AACvB,QAAA,MAAM,UAAA,GAAa,KAAK,MAAA,GAAS,CAAA;AAEjC,QAAA,KAAA,IAAS,IAAI,CAAA,EAAG,CAAA,GAAI,IAAA,CAAK,MAAA,EAAQ,KAAK,CAAA,EAAG;AACrC,UAAA,MAAM,CAAA,GAAI,KAAK,CAAC,CAAA;AAChB,UAAA,MAAM,CAAA,GAAI,IAAA,CAAK,CAAA,GAAI,CAAC,CAAA;AACpB,UAAA,MAAM,CAAA,GAAI,IAAA,CAAK,CAAA,GAAI,CAAC,CAAA;AAGpB,UAAA,MAAM,SAAA,GAAY,MAAA,GAAS,CAAA,GAAI,MAAA,GAAS,IAAI,MAAA,GAAS,CAAA;AACrD,UAAA,cAAA,IAAkB,SAAA;AAAA,QACtB;AAEA,QAAA,MAAM,eAAe,cAAA,GAAiB,UAAA;AAGtC,QAAA,MAAM,IAAA,GAAO,YAAA,GAAe,GAAA,GAAM,MAAA,GAAS,OAAA;AAE3C,QAAA,IAAA,CAAK,QAAQ,IAAI,CAAA;AAAA,MACrB,SAAS,GAAA,EAAK;AAAA,MACd;AAAA,IACJ,CAAA;AAEA,IAAA,SAAS,WAAW,CAAA,EAAG;AACnB,MAAA,QAAA,CAAS,KAAA,GAAQ,IAAA;AAEjB,MAAA,IAAI,MAAM,SAAA,EAAW;AACjB,QAAA,SAAA,CAAU,CAAC,CAAA;AAAA,MACf;AAEA,MAAA,IAAA,CAAK,QAAQ,CAAC,CAAA;AAAA,IAClB;AAEA,IAAA,SAAS,YAAY,CAAA,EAAG;AAEpB,MAAA,IAAA,CAAK,SAAS,CAAC,CAAA;AAAA,IACnB;AAEA,IAAA,MAAM,GAAA,GAAM,SAAS,MAAM;AACvB,MAAA,OAAO,CAAA,EAAG,KAAA,CAAM,OAAA,EAAS,OAAA,CAAQ,MAAM,CAAA,KAAM,EAAA,GAAK,mCAAA,GAAqC,EAAE,CAAA,EAAG,KAAA,CAAM,OAAO,CAAA,CAAA;AAAA,IAC7G,CAAC,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}